!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("JsFile")):"function"==typeof define&&define.amd?define(["JsFile"],b):"object"==typeof exports?exports.JsFileFb=b(require("JsFile")):a.JsFileFb=b(a.JsFile)}(this,function(a){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(b,"__esModule",{value:!0});var i=c(1),j=d(i),k=c(2),l=d(k),m=c(10),n=d(m),o=c(5),p=d(o),q=c(7),r=d(q),s=c(12),t=d(s),u=c(13),v=d(u),w=c(14),x=d(w),y=c(15),z=d(y),A=j["default"].Engine,B=j["default"].defineEngine,C={extension:["fb2"],mime:["application/x-fictionbook+xml"]},D=function(a){function b(){e(this,b);var a=f(this,Object.getPrototypeOf(b).apply(this,arguments));return a.createDocument=l["default"],a.files=C,a.parser=n["default"],a.parseFileInfo=p["default"],a.parseDocumentInfo=r["default"],a.parsePages=t["default"],a.parseBlockElement=v["default"],a.parseBlock=x["default"],a.parseParagraph=z["default"],a}return g(b,a),h(b,null,[{key:"test",value:function(a){return Boolean(a&&A.validateFile(a,C))}}]),b}(A);D.mimeTypes=C.mime.slice(0),B(D),b["default"]=D},function(b,c){b.exports=a},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){return new Promise(function(b){var c={meta:{name:this.fileName},binaryItems:(0,i["default"])(a.querySelectorAll("binary"))},d=t.elementPrototype,e=a.querySelector("FictionBook");v.call(e&&e.childNodes||[],function(a){var b=a.localName;if("description"===b){if(v.call(a.childNodes||[],function(a){var b=a.localName,d=w[b]||{},e=d.name,f=d.parser;f&&(c.meta[e||u(b)]=f.call(this,a,c))},this),c.meta.fileInfo&&c.meta.fileInfo.annotation&&d.children.push(c.meta.fileInfo.annotation),c.meta.fileInfo&&c.meta.fileInfo.coverpage&&c.binaryItems[c.meta.fileInfo.coverpage.image]){var e=t.elementPrototype;e.children=[(0,s["default"])({documentData:c,imageName:c.meta.fileInfo.coverpage.image})],d.children.push(e)}}else"body"===b&&this.parsePages(a,c,d.children)},this),b(new t({meta:c.meta,content:[d]}))}.bind(this))}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=e;var f=c(1),g=d(f),h=c(3),i=d(h),j=c(4),k=d(j),l=c(5),m=d(l),n=c(7),o=d(n),p=c(8),q=d(p),r=c(9),s=d(r),t=g["default"].Document,u=g["default"].Engine.formatPropertyName,v=[].forEach,w={"publish-info":{parser:k["default"]},"title-info":{name:"fileInfo",parser:m["default"]},"src-title-info":{name:"originalFileInfo",parser:m["default"]},"document-info":{parser:o["default"]},"custom-info":{parser:q["default"]}}},function(a,b){"use strict";function c(a){var b={};return[].forEach.call(a||[],function(a){var c=a.attributes||{},d=c["content-type"]&&c["content-type"].value;c.id&&c.id.value&&d&&a.textContent&&(b[c.id.value]="data:"+d+";base64,"+a.textContent)}),b}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=c},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){var b={};return[].forEach.call(a&&a.childNodes||[],function(a){var c=a.localName;c&&(b[h(c)]=a.textContent||"")}),b}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=e;var f=c(1),g=d(f),h=g["default"].Engine.formatPropertyName},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){var c={};return[].forEach.call(a&&a.childNodes||[],function(a){var d=a.localName,e=a.textContent,f=void 0===e?"":e;switch(d){case"genre":c[d]=c[d]||[],c[d].push(f);break;case"keywords":c[d]=f.split(/\s*,\s*/);break;case"annotation":c[d]=this.parseBlock(a,b);break;case"translator":c[d]=(0,i["default"])(a);break;case"coverpage":var g=a.querySelector("image"),h=g.attributes["xlink:href"]&&g.attributes["xlink:href"].value||"";c[d]={image:h.replace("#","")};break;case"sequence":var k=a.attributes.number&&a.attributes.number.value;c[d]={name:a.attributes.name?a.attributes.name.value||"":"",number:isNaN(k)?0:Number(k)};break;default:d&&(c[j(d)]=f)}},this),c}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=e;var f=c(1),g=d(f),h=c(6),i=d(h),j=g["default"].Engine.formatPropertyName},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){var b={};return[].forEach.call(a&&a.childNodes||[],function(a){var c=a.localName,d=a.textContent,e=void 0===d?"":d;c&&(b[h(c)]=e)}),b}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=e;var f=c(1),g=d(f),h=g["default"].Engine.formatPropertyName},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){var c={programs:[]};return[].forEach.call(a&&a.childNodes||[],function(a){var d=a.localName,e=a.textContent,f=void 0===e?"":e;switch(d){case"author":c[d]=(0,g["default"])(a);break;case"id":c[d]=f;break;case"version":c[d]=f;break;case"publisher":c[d]=f;break;case"history":c[d]=this.parseBlock(a,b);break;case"date":c[d]=f;break;case"src-url":c.sourceUrl=f;break;case"src-ocr":c.originalAuthor=f;break;case"program-used":c.programs=f.split(",").map(function(a){return a.trim()})}},this),c}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=e;var f=c(6),g=d(f)},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=function(a){return a&&a.textContent||""}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=h.elementPrototype,c=a.node,d=void 0===c?{}:c,e=a.documentData,f=a.imageName,g=d.attributes&&d.attributes["xlink:href"]&&d.attributes["xlink:href"].value;return!f&&g?b.properties.src=e.binaryItems[g.replace("#","")]:b.properties.src=e.binaryItems[f],b.properties.tagName="IMG",b.properties.src=b.properties.src||"",b.properties.alt="",b}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=e;var f=c(1),g=d(f),h=g["default"].Document},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){return new Promise(function(a,b){var c={file:this.file};if(!this.isValid())return void b(new Error(l));var d=function(b){var c=new DOMParser;a(this.createDocument(c.parseFromString(b,"application/xml")))}.bind(this);this.readFileEntry(c).then(function(a){var e=j["default"].defaultEncoding,g=/encoding="(.+)"/.exec(a),h=f(g,2),i=h[1];i=i?(0,j["default"])(i):e,i!==e?(c.encoding=i,this.readFileEntry(c).then(d,function(){return b(new Error(m))})):d(a)}.bind(this),function(){return b(new Error(m))})}.bind(this))}var f=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=e;var g=c(1),h=d(g),i=c(11),j=d(i),k=h["default"].Engine.errors,l=k.invalidFileType,m=k.invalidReadFile},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c={"windows-1251":"cp1251"},d=b.defaultEncoding="utf8";b["default"]=function(a){return a&&c[String(a).toLowerCase()]||d}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b,c){var d=a.attributes,e=void 0===d?{}:d;if([].forEach.call(a&&a.childNodes||[],function(a){var d=a.localName;"title"===d?c.push(this.parseBlock(a,b)):"section"===d?this.parsePages(a,b,c):d&&c.push(this.parseBlockElement({node:a,documentData:b}))},this),e.id&&e.id.value&&c[0]){var f=h.elementPrototype;f.properties.tagName="A",f.properties.name=e.id.value,c[c.length-1].children.unshift(f)}}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=e;var f=c(1),g=d(f),h=g["default"].Document},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=void 0,c=a.documentData,d=a.node,e=void 0===d?{}:d,f=e.localName;switch(f){case"p":b=this.parseParagraph({node:e});break;case"empty-line":b=j.elementPrototype,b.properties.tagName="BR";break;case"subtitle":b=this.parseParagraph({node:e}),b.style.textAlign="center";break;case"image":b=(0,g["default"])({node:e,documentData:c});break;default:f&&(b=this.parseBlock(e,c))}return b}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=e;var f=c(9),g=d(f),h=c(1),i=d(h),j=i["default"].Document},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){var c=h.elementPrototype;return[].forEach.call(a&&a.childNodes||[],function(a){a.localName&&c.children.push(this.parseBlockElement({node:a,documentData:b}))},this),c}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=e;var f=c(1),g=d(f),h=g["default"].Document},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=void 0,c=void 0,d=a.node,e=j.elementPrototype;if(e.properties.tagName="P",!d)return e;var f=[].slice.call(d&&d.childNodes||[],0);return f.forEach(function(a){var d=a.textContent,f=void 0===d?"":d,h=a.localName,i=a.attributes,k=void 0===i?{}:i;"a"===h?b=(0,g["default"])(a):(b=j.elementPrototype,b.properties.tagName="SPAN",b.properties.textContent=f,"strong"===h?b.style.fontWeight="bold":"emphasis"===h&&(b.style.fontStyle="italic")),c=k["xml:lang"]&&k["xml:lang"].value,c&&(b.properties.lang=c),e.children.push(b)}),c=d.attributes&&d.attributes["xml:lang"]&&d.attributes["xml:lang"].value,c&&(e.properties.lang=c),!f[0]&&d.textContent&&(b=j.elementPrototype,b.properties.textContent=d.textContent,e.children.push(b)),e}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=e;var f=c(16),g=d(f),h=c(1),i=d(h),j=i["default"].Document},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=h.elementPrototype,c=a.attributes["l:href"]||a.attributes["xlink:href"],d=c&&c.value||"";return b.properties.tagName="A",b.properties.textContent=a.textContent,b.properties.href=d,d&&"#"!==d[0]&&(b.properties.target="_blank"),b}Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=e;var f=c(1),g=d(f),h=g["default"].Document}])});