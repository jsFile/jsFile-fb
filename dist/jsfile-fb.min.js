!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("JsFile")):"function"==typeof define&&define.amd?define(["JsFile"],b):"object"==typeof exports?exports.JsFileFb=b(require("JsFile")):a.JsFileFb=b(a.JsFile)}(this,function(a){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}},i=c(1),j=c(2),k=d(j),l=c(6),m=d(l),n=c(8),o=d(n),p=c(10),q=d(p),r=c(11),s=d(r),t=c(12),u=d(t),v=c(13),w=d(v),x=c(14),y=d(x),z={extension:["fb2"],mime:["application/x-fictionbook+xml"]},A=function(a){function b(){e(this,b),h(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments),this.createDocument=k["default"],this.files=z,this.parser=m["default"],this.parseFileInfo=o["default"],this.parseDocumentInfo=q["default"],this.parsePages=s["default"],this.parseBlockElement=u["default"],this.parseBlock=w["default"],this.parseParagraph=y["default"]}return f(b,a),g(b,null,[{key:"test",value:function(a){return Boolean(a&&i.Engine.validateFile(a,z))}},{key:"mimeTypes",value:z.mime.slice(0),enumerable:!0}]),b}(i.Engine);i.defineEngine(A),b["default"]=A,a.exports=b["default"]},function(b,c){b.exports=a},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(1),f=d(e),g=c(3),h=d(g),i=c(4),j=d(i),k=c(5),l=d(k),m=f["default"].Document;b["default"]=function(a){return new Promise(function(b){var c={binaryItems:h["default"](a.querySelectorAll("binary"))},d=m.elementPrototype,e=a.querySelector("FictionBook");[].forEach.call(e&&e.childNodes||[],function(b){var e=b.localName;if("description"===e){var f=a.querySelector("description");if(c.publishInfo=j["default"](f.querySelector("publish-info")),c.fileInfo=this.parseFileInfo(f.querySelector("title-info"),c),c.documentInfo=this.parseDocumentInfo(f.querySelector("document-info"),c),c.fileInfo.annotation&&d.children.push(c.fileInfo.annotation),c.fileInfo.coverpage&&c.binaryItems[c.fileInfo.coverpage.image]){var g=m.elementPrototype;g.children=[l["default"]({documentData:c,imageName:c.fileInfo.coverpage.image})],d.children.push(g)}}else"body"===e&&this.parsePages(b,c,d.children)},this),b(new m({name:this.fileName,content:[d]}))}.bind(this))},a.exports=b["default"]},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=function(a){var b={};return[].forEach.call(a||[],function(a){var c=a.attributes||{},d=c["content-type"]&&c["content-type"].value;c.id&&c.id.value&&d&&a.textContent&&(b[c.id.value]="data:"+d+";base64,"+a.textContent)}),b},a.exports=b["default"]},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=function(a){var b={};return[].forEach.call(a&&a.childNodes||[],function(a){return b[a.localName]=a.textContent||""}),b},a.exports=b["default"]},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(1);b["default"]=function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=d.Document.elementPrototype,c=a.node,e=void 0===c?{}:c,f=a.documentData,g=a.imageName,h=e.attributes&&e.attributes["xlink:href"]&&e.attributes["xlink:href"].value;return!g&&h?b.properties.src=f.binaryItems[h.replace("#","")]:b.properties.src=f.binaryItems[g],b.properties.tagName="IMG",b.properties.src=b.properties.src||"",b.properties.alt="",b},a.exports=b["default"]},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),f=c(1),g=d(f),h=c(7),i=d(h),j=g["default"].Engine.errors,k=j.invalidFileType,l=j.invalidReadFile;b["default"]=function(){return new Promise(function(a,b){var c={file:this.file};if(!this.isValid())return void b(new Error(k));var d=function(b){var c=new DOMParser;a(this.createDocument(c.parseFromString(b,"application/xml")))}.bind(this);this.readFileEntry(c).then(function(a){var f=i["default"].defaultEncoding,g=/encoding="(.+)"/.exec(a),h=e(g,2),j=h[1];j=j?i["default"](j):f,j!==f?(c.encoding=j,this.readFileEntry(c).then(d,function(){return b(new Error(l))})):d(a)}.bind(this),function(){return b(new Error(l))})}.bind(this))},a.exports=b["default"]},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c={"windows-1251":"cp1251"},d="utf8";b.defaultEncoding=d,b["default"]=function(a){return a&&c[String(a).toLowerCase()]||d}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(9),f=(d(e),{genre:"genre",lang:"language",translator:"translator",date:"date",author:"author","src-lang":"sourceLanguage","book-title":"title"});b["default"]=function(a,b){var c={};return[].forEach.call(a&&a.childNodes||[],function(a){var d=a.localName,e=a.textContent,g=void 0===e?"":e;if(f[d])c[f[d]]=g;else if("annotation"===d)c.annotation=this.parseBlock(a,b);else if("coverpage"===d){var h=a.querySelector("image");c.coverpage={image:(h.attributes["xlink:href"]&&h.attributes["xlink:href"].value||"").replace("#","")}}else if("sequence"===d){var i=a.attributes.number&&a.attributes.number.value;c.sequence={name:a.attributes.name?a.attributes.name.value||"":"",number:isNaN(i)?0:Number(i)}}},this),c},a.exports=b["default"]},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=function(a){var b={};return[].forEach.call(a&&a.childNodes||[],function(a){var c=a.localName,d=a.textContent;c&&(b[c.replace(/-\w+$/,"")+"Name"]=d||"")}),b},a.exports=b["default"]},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(9),f=d(e);b["default"]=function(a,b){var c={programs:[]};return[].forEach.call(a&&a.childNodes||[],function(a){var d=a.localName,e=a.textContent,g=void 0===e?"":e;switch(d){case"author":c.author=f["default"](a);break;case"src-url":c.sourceURL=g;break;case"id":c.id=g;break;case"version":c.version=g;break;case"history":c.history=this.parseBlock(a,b);break;case"date":c.date=g.split("-").reverse().join(".");break;case"program-used":c.programs=g.split(",").map(function(a){return a.trim()})}},this),c},a.exports=b["default"]},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(1);b["default"]=function(a,b,c){var e=a.attributes,f=void 0===e?{}:e;if([].forEach.call(a&&a.childNodes||[],function(a){var d=a.localName;"title"===d?c.push(this.parseBlock(a,b)):"section"===d?this.parsePages(a,b,c):d&&c.push(this.parseBlockElement({node:a,documentData:b}))},this),f.id&&f.id.value&&c[0]){var g=d.Document.elementPrototype;g.properties.tagName="A",g.properties.name=f.id.value,c[c.length-1].children.unshift(g)}},a.exports=b["default"]},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(1),f=c(5),g=d(f);b["default"]=function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=void 0,c=a.documentData,d=a.node,f=void 0===d?{}:d;switch(f.localName){case"p":b=this.parseParagraph({node:f});break;case"empty-line":b=e.Document.elementPrototype,b.properties.tagName="BR";break;case"subtitle":b=this.parseParagraph({node:f}),b.style.textAlign="center";break;case"image":b=g["default"]({node:f,documentData:c});break;default:b=this.parseBlock(f,c)}return b},a.exports=b["default"]},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(1);b["default"]=function(a,b){var c=d.Document.elementPrototype;return[].forEach.call(a&&a.childNodes||[],function(a){a.localName&&c.children.push(this.parseBlockElement({node:a,documentData:b}))},this),c},a.exports=b["default"]},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(1),f=c(15),g=d(f);b["default"]=function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=a.node||{},c=[].slice.call(b&&b.childNodes||[],0),d=void 0,f=e.Document.elementPrototype;return f.properties.tagName="P",c.forEach(function(a){var b=a.textContent,c=void 0===b?"":b,h=a.localName;"a"===h?f.children.push(g["default"](a)):(d=e.Document.elementPrototype,d.properties.tagName="SPAN",d.properties.textContent=c,"strong"===h?d.style.fontWeight="bold":"emphasis"===h&&(d.style.fontStyle="italic"),f.children.push(d))}),!c[0]&&b.textContent&&(d=e.Document.elementPrototype,d.properties.textContent=b.textContent,f.children.push(d)),f},a.exports=b["default"]},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(1);b["default"]=function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=d.Document.elementPrototype,c=a.attributes["l:href"]||a.attributes["xlink:href"],e=c&&c.value||"";return b.properties.tagName="A",b.properties.textContent=a.textContent,b.properties.href=e,e&&"#"!==e[0]&&(b.properties.target="_blank"),b},a.exports=b["default"]}])});